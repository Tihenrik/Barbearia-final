<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pedro Barbearia</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ESTILOS VISUAIS --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 4px; }
        
        :root {
            --gold: #d4af37;
            --dark: #121212;
            --darker: #0a0a0a;
            --light-gray: #e5e5e5;
        }
        
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--darker); color: var(--light-gray); }
        
        .slot-btn { transition: all 0.2s; }
        .slot-btn:active { transform: scale(0.95); }
        
        .loader { border-top-color: var(--gold); -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Ajuste para Inputs Autocomplete do Chrome ficarem escuros */
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active{
            -webkit-box-shadow: 0 0 0 30px #262626 inset !important;
            -webkit-text-fill-color: white !important;
            transition: background-color 5000s ease-in-out 0s;
        }
        
        .toggle-checkbox:checked { right: 0; border-color: #d4af37; }
        .toggle-checkbox:checked + .toggle-label { background-color: #d4af37; }
        
        .collapsible-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .collapsible-content.open {
            max-height: 600px; 
            opacity: 1;
        }

        /* Animação suave para novos dias no calendário */
        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .day-card { animation: fadeInRight 0.3s ease-out forwards; }

        /* Animação de troca de abas */
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden select-none">

    <header class="bg-neutral-900 border-b border-yellow-600 p-3 flex justify-between items-center shadow-lg z-10 shrink-0">
        <div class="flex items-center gap-2">
            <i class="fas fa-cut text-yellow-500 text-lg"></i>
            <h1 class="font-bold text-lg tracking-wider text-white">PEDRO <span class="text-yellow-500">BARBEARIA</span></h1>
        </div>
        <div id="user-nav" class="hidden flex items-center gap-3">
            <button id="admin-btn" class="hidden text-[10px] bg-red-900 text-red-100 px-2 py-1 rounded border border-red-700 hover:bg-red-800 transition">
                <i class="fas fa-lock"></i> ADMIN
            </button>
            <button onclick="logout()" class="text-xs text-gray-400 hover:text-white transition">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto relative p-2 max-w-md mx-auto w-full">
        
        <div id="loading" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex flex-col items-center justify-center hidden">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-700 h-12 w-12 mb-4"></div>
            <p class="text-yellow-500 animate-pulse">Processando...</p>
        </div>

        <div id="auth-screen" class="flex flex-col justify-center h-full pb-10">
            
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-white">Bem-vindo</h2>
                <p class="text-gray-500 text-sm">Agende seu estilo</p>
            </div>

            <div class="bg-neutral-900 rounded-lg border border-neutral-800 shadow-xl overflow-hidden">
                
                <div class="flex">
                    <button onclick="switchAuthTab('login')" id="tab-btn-login" class="flex-1 py-3 text-[11px] font-bold text-yellow-500 border-b-2 border-yellow-500 transition-colors bg-neutral-900 outline-none uppercase tracking-wide">
                        <i class="fas fa-sign-in-alt mr-1"></i> Entrar
                    </button>
                    <button onclick="switchAuthTab('register')" id="tab-btn-register" class="flex-1 py-3 text-[11px] font-bold text-gray-500 hover:text-gray-300 transition-colors bg-neutral-800 outline-none uppercase tracking-wide border-b border-neutral-800">
                        <i class="fas fa-user-plus mr-1"></i> Criar Conta
                    </button>
                    <button onclick="switchAuthTab('location')" id="tab-btn-location" class="flex-1 py-3 text-[11px] font-bold text-gray-500 hover:text-gray-300 transition-colors bg-neutral-800 outline-none uppercase tracking-wide border-b border-neutral-800">
                        <i class="fas fa-map-marker-alt mr-1"></i> Local
                    </button>
                </div>

                <div class="p-6">
                    <div id="tab-content-login" class="tab-content active">
                        <form id="login-form" class="space-y-4">
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">E-mail</label>
                                <input type="email" id="login-email" class="w-full bg-neutral-800 border border-neutral-700 rounded p-3 text-white focus:border-yellow-500 outline-none placeholder-gray-600 text-sm" required placeholder="seu@email.com">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">Senha</label>
                                <input type="password" id="login-pass" class="w-full bg-neutral-800 border border-neutral-700 rounded p-3 text-white focus:border-yellow-500 outline-none placeholder-gray-600 text-sm" required placeholder="******">
                                <div class="text-right mt-1">
                                    <button type="button" onclick="resetPassword()" class="text-xs text-gray-500 hover:text-yellow-500">Esqueci a senha</button>
                                </div>
                            </div>
                            <button type="submit" id="btn-login-submit" class="w-full bg-yellow-600 hover:bg-yellow-500 text-black font-bold py-3 rounded transition disabled:opacity-50 disabled:cursor-not-allowed text-sm">ENTRAR</button>
                        </form>
                    </div>

                    <div id="tab-content-register" class="tab-content">
                         <form id="register-form" class="space-y-3">
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">Nome</label>
                                <input type="text" id="reg-name" class="w-full bg-neutral-800 border border-neutral-700 rounded p-3 text-white focus:border-yellow-500 outline-none placeholder-gray-600 text-sm" required placeholder="Seu Nome">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">Telefone (WhatsApp)</label>
                                <input type="tel" id="reg-phone" class="w-full bg-neutral-800 border border-neutral-700 rounded p-3 text-white focus:border-yellow-500 outline-none placeholder-gray-600 text-sm" required placeholder="(XX) XXXXX-XXXX">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">E-mail</label>
                                <input type="email" id="reg-email" class="w-full bg-neutral-800 border border-neutral-700 rounded p-3 text-white focus:border-yellow-500 outline-none placeholder-gray-600 text-sm" required placeholder="seu@email.com">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-400 mb-1">Senha</label>
                                <input type="password" id="reg-pass" class="w-full bg-neutral-800 border border-neutral-700 rounded p-3 text-white focus:border-yellow-500 outline-none placeholder-gray-600 text-sm" required placeholder="******" minlength="6">
                            </div>
                            <button type="submit" id="btn-reg-submit" class="w-full bg-yellow-600 hover:bg-yellow-500 text-black font-bold py-3 rounded transition disabled:opacity-50 disabled:cursor-not-allowed text-sm">CADASTRAR</button>
                        </form>
                    </div>

                    <div id="tab-content-location" class="tab-content text-center space-y-6 pt-2">
                        <div class="space-y-2">
                            <div class="w-12 h-12 bg-neutral-800 rounded-full flex items-center justify-center mx-auto mb-3 border border-yellow-600/30">
                                <i class="fas fa-map-marked-alt text-xl text-yellow-500"></i>
                            </div>
                            <h3 class="text-white font-bold text-base">Nosso Endereço</h3>
                            <p class="text-gray-300 text-sm leading-relaxed bg-neutral-800 p-3 rounded border border-neutral-700">
                                Rua Manuel de Macedo, 1815<br>
                                <span class="text-gray-500 text-xs uppercase font-bold mt-1 block">Bairro Jardim Piratininga</span>
                            </p>
                        </div>

                        <div class="border-t border-neutral-800 pt-5">
                            <h3 class="text-white font-bold text-sm mb-3 uppercase tracking-wide">Fale Conosco</h3>
                            
                            <button onclick="copyToClipboard('(16) 9821-41433', this)" class="mx-auto flex items-center justify-center gap-2 bg-green-900/20 hover:bg-green-900/30 text-green-500 border border-green-900/40 rounded-full px-5 py-2.5 transition active:scale-95 w-full max-w-[200px] outline-none">
                                <i class="fab fa-whatsapp text-lg"></i>
                                <span class="font-bold text-sm tracking-wide">(16) 9821-41433</span>
                            </button>
                            <p class="text-[10px] mt-2 text-gray-600">Toque no número para copiar</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div id="dashboard-screen" class="hidden space-y-3 pb-20 h-full flex flex-col">
            <div id="closed-banner" class="hidden bg-red-900/80 border border-red-500 text-white p-2 rounded text-center mb-1 animate-pulse text-sm shrink-0">
                <i class="fas fa-store-slash mr-1"></i> <span class="font-bold">Fechado:</span> <span id="closed-reason-display"></span>
            </div>

            <div class="shrink-0">
                <div id="date-container-wrapper" class="overflow-x-auto pb-2 scrollbar-hide">
                    <div id="date-container" class="flex gap-2 min-w-max px-1">
                        </div>
                </div>
                
                <div id="selected-date-display" class="text-center text-yellow-500 font-bold text-base py-1 border-b border-neutral-800">
                    </div>
            </div>

            <div class="flex-1 overflow-y-auto pr-1">
                <div id="slots-grid" class="grid grid-cols-4 gap-2 pb-10">
                    </div>
                
                <div id="empty-msg" class="text-center text-gray-500 mt-10 hidden">
                    <i class="far fa-clock text-3xl mb-2 opacity-50"></i><br>
                    <span class="text-sm">Sem horários.</span>
                </div>
            </div>
        </div>

        <div id="admin-screen" class="hidden space-y-4 pb-20">
            <div class="flex justify-between items-center mb-4 border-b border-neutral-800 pb-2">
                <h2 class="text-xl text-yellow-500 font-bold">Painel Administrativo</h2>
                <button onclick="showScreen('dashboard-screen')" class="text-sm text-gray-400 hover:text-white"><i class="fas fa-arrow-left"></i> Voltar</button>
            </div>

            <div class="bg-neutral-900 rounded border border-yellow-600/50 mb-4 overflow-hidden">
                <div onclick="toggleConfigPanel()" class="p-4 flex justify-between items-center cursor-pointer bg-neutral-800/50 hover:bg-neutral-800 transition">
                    <h3 class="text-white font-bold text-sm uppercase tracking-wide">
                        <i class="fas fa-cogs text-yellow-500 mr-2"></i> Configurações
                    </h3>
                    <i id="config-chevron" class="fas fa-chevron-down text-gray-400 transition-transform duration-300"></i>
                </div>

                <div id="config-content" class="collapsible-content border-t border-neutral-800">
                    <div class="p-4">
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div>
                                <label class="text-xs text-gray-400 block mb-1">Abre às:</label>
                                <select id="conf-open" class="w-full bg-neutral-800 text-white p-2 rounded border border-neutral-700 text-sm"></select>
                            </div>
                            <div>
                                <label class="text-xs text-gray-400 block mb-1">Fecha às:</label>
                                <select id="conf-close" class="w-full bg-neutral-800 text-white p-2 rounded border border-neutral-700 text-sm"></select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="text-xs text-gray-400 block mb-1">Intervalo (Duração):</label>
                            <select id="conf-interval" class="w-full bg-neutral-800 text-white p-2 rounded border border-neutral-700 text-sm">
                                <option value="20">20 Minutos</option>
                                <option value="30">30 Minutos</option>
                                <option value="40">40 Minutos</option>
                                <option value="45">45 Minutos</option>
                                <option value="60">1 Hora (Padrão)</option>
                                <option value="90">1h 30min</option>
                            </select>
                        </div>

                        <div class="border-t border-neutral-800 pt-3 mt-3">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-xs text-white font-bold uppercase">Fechar Agenda</label>
                                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" name="toggle" id="conf-is-closed" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300"/>
                                    <label for="conf-is-closed" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-700 cursor-pointer"></label>
                                </div>
                            </div>
                            <div id="closed-msg-container" class="hidden">
                                <label class="text-xs text-gray-400 block mb-1">Motivo:</label>
                                <input type="text" id="conf-closed-msg" class="w-full bg-neutral-800 text-white p-2 rounded border border-neutral-700 text-sm placeholder-gray-600" placeholder="Ex: Fechado para reforma">
                            </div>
                        </div>

                        <button onclick="saveAdminConfig()" class="mt-4 w-full bg-yellow-600 text-black font-bold py-2 rounded hover:bg-yellow-500 text-sm">SALVAR E ATUALIZAR</button>
                    </div>
                </div>
            </div>
            
            <div class="bg-neutral-900 p-4 rounded border border-neutral-800">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-white font-bold text-sm uppercase tracking-wide">Agendamentos</h3>
                    <span id="admin-count" class="text-xs bg-yellow-600 text-black px-2 rounded font-bold">0</span>
                </div>
                <div id="admin-list" class="space-y-3 max-h-80 overflow-y-auto pr-1 scrollbar-thin"></div>
            </div>
            
            <div class="bg-neutral-900 p-4 rounded border border-neutral-800 mt-4">
                <h3 class="text-white font-bold mb-2 text-sm uppercase tracking-wide">Bloquear Usuário</h3>
                <div class="flex gap-2 mb-2">
                    <input type="email" id="block-email-input" placeholder="email@usuario.com" class="bg-neutral-800 border border-neutral-700 text-white p-2 rounded w-full text-sm focus:border-yellow-500 outline-none">
                    <button onclick="blockUserAction()" class="bg-red-700 text-white px-4 rounded hover:bg-red-600 text-sm font-bold">BLOQUEAR</button>
                </div>
                <div class="mt-4 border-t border-neutral-800 pt-2">
                    <h4 class="text-xs text-gray-400 uppercase mb-2">Usuários Bloqueados</h4>
                    <div id="blocked-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                </div>
            </div>
        </div>

    </main>

    <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-90 z-40 flex items-end sm:items-center justify-center hidden backdrop-blur-sm">
        <div class="bg-neutral-900 w-full max-w-md rounded-t-2xl sm:rounded-2xl p-6 border-t-2 sm:border-2 border-yellow-600 animate-slide-up">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Confirmar</h3>
                <button onclick="closeModal('booking-modal')" class="text-gray-400 hover:text-white text-xl"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="mb-6 bg-neutral-800 p-3 rounded flex justify-between items-center">
                <div>
                    <p class="text-gray-400 text-xs uppercase">Data</p>
                    <p id="modal-date" class="text-white font-bold text-sm"></p>
                </div>
                <div class="text-right">
                    <p class="text-gray-400 text-xs uppercase">Horário</p>
                    <p id="modal-time" class="text-yellow-500 font-bold text-xl"></p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-300 mb-1">Serviço</label>
                    <select id="service-select" class="w-full bg-neutral-800 text-white border border-neutral-600 rounded p-3 focus:border-yellow-500 outline-none appearance-none">
                        <option value="Corte">Corte</option>
                        <option value="Barba">Barba</option>
                        <option value="Corte e Barba">Corte e Barba</option>
                        <option value="Sobrancelha">Sobrancelha</option>
                        <option value="Luzes">Luzes / Platina</option>
                        <option value="Completo">Completo</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm text-gray-300 mb-1">Obs (Opcional)</label>
                    <textarea id="notes-input" rows="2" class="w-full bg-neutral-800 text-white border border-neutral-600 rounded p-3 focus:border-yellow-500 outline-none text-sm" placeholder="Ex: Atraso de 5 min..."></textarea>
                </div>

                <button onclick="confirmBooking()" id="btn-confirm-booking" class="w-full bg-yellow-600 text-black font-bold py-3 rounded hover:bg-yellow-500 shadow-lg shadow-yellow-900/20 transition transform active:scale-95">
                    CONFIRMAR
                </button>
            </div>
        </div>
    </div>

    <div id="custom-alert" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center hidden backdrop-blur-sm">
        <div class="bg-neutral-800 p-6 rounded-lg max-w-xs w-full text-center border border-neutral-700 shadow-2xl transform scale-100">
            <div id="alert-icon" class="text-5xl mb-4"></div>
            <h3 id="alert-title" class="text-xl font-bold text-white mb-2"></h3>
            <p id="alert-msg" class="text-gray-400 text-sm mb-6 leading-relaxed break-words"></p>
            <div id="alert-actions" class="flex justify-center gap-3"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, deleteDoc, query, where, onSnapshot, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCGV7U1FZN5Jk-qyq4VJAm9EFIk02GdvB8",
            authDomain: "wlf-barbearia.firebaseapp.com",
            projectId: "wlf-barbearia",
            storageBucket: "wlf-barbearia.firebasestorage.app",
            messagingSenderId: "654898502604",
            appId: "1:654898502604:web:c71549030e78c6b7625b69"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const rawAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';
        const APP_ID_PATH = rawAppId.replace(/[^a-zA-Z0-9-_]/g, '');
        
        const BOOKINGS_PATH = `artifacts/${APP_ID_PATH}/public/data/bookings`;
        const BLOCKED_USERS_PATH = `artifacts/${APP_ID_PATH}/public/data/blocked_users`;
        const CONFIG_COLLECTION_PATH = `artifacts/${APP_ID_PATH}/public/data/config`;
        const USERS_COLLECTION_PATH = `artifacts/${APP_ID_PATH}/public/data/users_profile`; 
        const ADMIN_DOC_ID = 'admin_settings';

        let currentUser = null;
        let currentUserData = {}; 
        let isAdmin = false;
        let bookingsMap = {}; 
        let blockedMap = {};
        let adminConfig = { openHour: 9, closeHour: 20, interval: 60, isClosed: false, closedMessage: "" }; 
        let selectedDate = new Date();
        let selectedTime = null;
        let unsubscribeBookings = null;
        let unsubscribeBlocked = null;
        
        // Variáveis para o Calendário Infinito
        let renderedDaysCount = 0;
        const DAYS_BATCH_SIZE = 30;

        window.addEventListener('DOMContentLoaded', () => {
            initAuthListener();
            setupPhoneMask();
            populateTimeSelects();
            setupConfigToggle();
            initInfiniteScroll();
        });

        // --- SISTEMA DE 3 ABAS COM VISUAL CORRIGIDO ---
        window.switchAuthTab = (tabName) => {
            // Esconde todos
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            
            // Gerencia estilos dos botões (Active vs Inactive)
            const tabs = ['login', 'register', 'location'];
            tabs.forEach(name => {
                const btn = document.getElementById(`tab-btn-${name}`);
                if(name === tabName) {
                    // Ativo: Cor do fundo igual ao conteúdo (neutral-900), Borda Amarela
                    btn.className = "flex-1 py-3 text-[11px] font-bold text-yellow-500 border-b-2 border-yellow-500 transition-colors bg-neutral-900 outline-none uppercase tracking-wide";
                } else {
                    // Inativo: Fundo mais claro (neutral-800), Borda Cinza
                    btn.className = "flex-1 py-3 text-[11px] font-bold text-gray-500 hover:text-gray-300 transition-colors bg-neutral-800 outline-none uppercase tracking-wide border-b border-neutral-800";
                }
            });

            // Mostra o conteúdo
            document.getElementById(`tab-content-${tabName}`).classList.add('active');
        };

        function setupPhoneMask() {
            const phoneInput = document.getElementById('reg-phone');
            phoneInput.addEventListener('input', function (e) {
                let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
                e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
            });
        }

        function populateTimeSelects() {
            const openSel = document.getElementById('conf-open');
            const closeSel = document.getElementById('conf-close');
            for(let i=6; i<=23; i++) {
                let time = i.toString().padStart(2, '0') + ":00";
                openSel.innerHTML += `<option value="${i}">${time}</option>`;
                closeSel.innerHTML += `<option value="${i}">${time}</option>`;
            }
        }
        
        function setupConfigToggle() {
            const chk = document.getElementById('conf-is-closed');
            const msgContainer = document.getElementById('closed-msg-container');
            chk.addEventListener('change', () => {
                msgContainer.classList.toggle('hidden', !chk.checked);
            });
        }

        window.toggleConfigPanel = () => {
            const content = document.getElementById('config-content');
            const chevron = document.getElementById('config-chevron');
            content.classList.toggle('open');
            if (content.classList.contains('open')) {
                chevron.style.transform = 'rotate(180deg)';
            } else {
                chevron.style.transform = 'rotate(0deg)';
            }
        };

        function getLocalISODate(date) {
            const offset = date.getTimezoneOffset() * 60000;
            return new Date(date.getTime() - offset).toISOString().split('T')[0];
        }

        function initAuthListener() {
            showLoading(true);
            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                if (user) {
                    try {
                        await fetchUserProfile(user.uid);
                        await checkBlockedStatus(user.email);
                        await checkAdminStatus(user.email); 
                        
                        document.getElementById('auth-screen').classList.add('hidden');
                        document.getElementById('user-nav').classList.remove('hidden');
                        document.getElementById('dashboard-screen').classList.remove('hidden');
                        
                        updateAdminUI();
                        resetCalendar(); 
                        setupRealtimeListeners(); 
                    } catch (e) {
                        console.error("Startup Error:", e);
                        if(e.message !== "BLOCKED") {
                             resetCalendar();
                             setupRealtimeListeners();
                             document.getElementById('auth-screen').classList.add('hidden');
                             document.getElementById('dashboard-screen').classList.remove('hidden');
                        }
                    }
                } else {
                    resetAuthForms();
                    showScreen('auth-screen');
                    document.getElementById('user-nav').classList.add('hidden');
                    if (unsubscribeBookings) unsubscribeBookings();
                    if (unsubscribeBlocked) unsubscribeBlocked();
                }
                showLoading(false);
            });
        }

        function resetAuthForms() {
            document.getElementById('login-form').reset();
            document.getElementById('register-form').reset();
            document.getElementById('btn-login-submit').disabled = false;
            document.getElementById('btn-login-submit').innerText = "ENTRAR";
            document.getElementById('btn-reg-submit').disabled = false;
            document.getElementById('btn-reg-submit').innerText = "CADASTRAR";
        }

        async function fetchUserProfile(uid) {
            try {
                const snap = await getDoc(doc(db, USERS_COLLECTION_PATH, uid));
                if (snap.exists()) currentUserData = snap.data();
                else currentUserData = {};
            } catch(e) { console.log("Erro perfil", e); }
        }

        function updateAdminUI() {
            const adminBtn = document.getElementById('admin-btn');
            if (isAdmin) {
                adminBtn.classList.remove('hidden');
                adminBtn.onclick = () => showScreen('admin-screen');
                
                document.getElementById('conf-open').value = adminConfig.openHour;
                document.getElementById('conf-close').value = adminConfig.closeHour;
                document.getElementById('conf-interval').value = adminConfig.interval;
                document.getElementById('conf-is-closed').checked = adminConfig.isClosed || false;
                document.getElementById('conf-closed-msg').value = adminConfig.closedMessage || "";
                document.getElementById('closed-msg-container').classList.toggle('hidden', !adminConfig.isClosed);
            } else {
                adminBtn.classList.add('hidden');
            }
        }

        async function checkAdminStatus(email) {
            try {
                const adminDocRef = doc(db, CONFIG_COLLECTION_PATH, ADMIN_DOC_ID);
                const adminSnap = await getDoc(adminDocRef);

                if (adminSnap.exists()) {
                    const data = adminSnap.data();
                    isAdmin = (data.email === email);
                    if(data.config) adminConfig = { ...adminConfig, ...data.config };
                } else {
                    await setDoc(adminDocRef, { 
                        email: email, 
                        uid: currentUser.uid,
                        config: adminConfig 
                    });
                    isAdmin = true;
                }
            } catch (e) {
                console.error("Erro Admin/Config:", e);
                isAdmin = false; 
            }
        }

        async function checkBlockedStatus(email) {
            try {
                const q = query(collection(db, BLOCKED_USERS_PATH), where("email", "==", email));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    await signOut(auth);
                    showAlert('Acesso Negado', 'Sua conta está bloqueada.', 'lock');
                    throw new Error("BLOCKED");
                }
            } catch (e) { if(e.message === "BLOCKED") throw e; }
        }

        function setupRealtimeListeners() {
            if (unsubscribeBookings) unsubscribeBookings();
            if (unsubscribeBlocked) unsubscribeBlocked();

            const todayStr = getLocalISODate(new Date());
            const q = query(
                collection(db, BOOKINGS_PATH),
                where("date", ">=", todayStr)
            );
            
            unsubscribeBookings = onSnapshot(q, (snapshot) => {
                bookingsMap = {};
                snapshot.forEach(doc => {
                    bookingsMap[doc.id] = doc.data();
                });
                renderSlots(selectedDate);
                if(isAdmin && !document.getElementById('admin-screen').classList.contains('hidden')) renderAdminList();
            }, (error) => {
                const qFallback = collection(db, BOOKINGS_PATH);
                unsubscribeBookings = onSnapshot(qFallback, (snapFallback) => {
                    bookingsMap = {};
                    snapFallback.forEach(doc => {
                        const data = doc.data();
                        if (data.date >= todayStr) bookingsMap[doc.id] = data;
                    });
                    renderSlots(selectedDate);
                });
            });

            if(isAdmin) {
                const qBlocked = collection(db, BLOCKED_USERS_PATH);
                unsubscribeBlocked = onSnapshot(qBlocked, (snapshot) => {
                    blockedMap = {};
                    snapshot.forEach(doc => { blockedMap[doc.id] = doc.data(); });
                    if(!document.getElementById('admin-screen').classList.contains('hidden')) renderBlockedList();
                });
            }
        }

        // --- LÓGICA DO CALENDÁRIO INFINITO ---
        function resetCalendar() {
            const container = document.getElementById('date-container');
            container.innerHTML = '';
            renderedDaysCount = 0;
            const today = new Date();
            selectedDate = today;
            appendDaysToCalendar(DAYS_BATCH_SIZE);
            renderSlots(selectedDate);
        }

        function initInfiniteScroll() {
            const wrapper = document.getElementById('date-container-wrapper');
            wrapper.addEventListener('scroll', () => {
                if (wrapper.scrollWidth - wrapper.scrollLeft - wrapper.clientWidth < 50) {
                    appendDaysToCalendar(DAYS_BATCH_SIZE);
                }
            });
        }

        function appendDaysToCalendar(count) {
            const container = document.getElementById('date-container');
            const today = new Date();
            const days = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            
            for (let i = 0; i < count; i++) {
                const offset = renderedDaysCount + i;
                const d = new Date();
                d.setDate(today.getDate() + offset);
                
                const dayOfWeek = d.getDay();
                const btn = document.createElement('div');
                
                const isSelected = getLocalISODate(d) === getLocalISODate(selectedDate);
                
                let baseClass = "day-card flex flex-col items-center justify-center min-w-[60px] h-[70px] rounded-xl border transition-all cursor-pointer select-none ";
                let activeClass = "bg-yellow-600 border-yellow-500 text-black shadow-lg shadow-yellow-900/40 transform scale-105 z-10";
                let inactiveClass = "bg-neutral-800 border-neutral-700 text-gray-400 hover:border-yellow-600 hover:text-gray-200";

                if (!isSelected && (dayOfWeek === 0 || dayOfWeek === 6)) {
                    inactiveClass += " bg-neutral-800/50"; 
                }

                btn.className = baseClass + (isSelected ? activeClass : inactiveClass);
                btn.dataset.date = getLocalISODate(d);
                
                btn.innerHTML = `
                    <span class="text-[9px] font-bold uppercase tracking-wider">${days[dayOfWeek]}</span>
                    <span class="text-xl font-bold leading-none mt-1">${d.getDate()}</span>
                    <span class="text-[8px] opacity-60">${d.getMonth()+1}/${d.getFullYear().toString().substr(-2)}</span>
                `;
                
                const dateToSelect = new Date(d);
                btn.onclick = () => {
                    Array.from(container.children).forEach(c => { 
                        c.className = baseClass + "bg-neutral-800 border-neutral-700 text-gray-400 hover:border-yellow-600 hover:text-gray-200";
                    });
                    btn.className = baseClass + activeClass;
                    selectedDate = dateToSelect;
                    renderSlots(dateToSelect);
                };
                container.appendChild(btn);
            }
            renderedDaysCount += count;
        }

        // --- GRADE COMPACTA (4 COLUNAS + INDICADORES) ---
        function renderSlots(dateObj) {
            const container = document.getElementById('slots-grid');
            container.innerHTML = '';
            const emptyMsg = document.getElementById('empty-msg');
            const closedBanner = document.getElementById('closed-banner');
            const dateStr = getLocalISODate(dateObj);
            
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            const displayDate = dateObj.toLocaleDateString('pt-BR', options);
            document.getElementById('selected-date-display').innerText = displayDate.charAt(0).toUpperCase() + displayDate.slice(1);

            if (adminConfig.isClosed) {
                closedBanner.classList.remove('hidden');
                document.getElementById('closed-reason-display').innerText = adminConfig.closedMessage || "Indisponível";
            } else {
                closedBanner.classList.add('hidden');
            }

            let hasSlots = false;
            const now = new Date();
            const isToday = dateStr === getLocalISODate(now);
            const currentHour = now.getHours();
            const currentMin = now.getMinutes();

            const startMin = adminConfig.openHour * 60;
            const endMin = adminConfig.closeHour * 60;
            const interval = parseInt(adminConfig.interval);

            for (let m = startMin; m < endMin; m += interval) {
                const h = Math.floor(m / 60);
                const min = m % 60;
                const timeStr = `${h.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
                const bookingId = `${dateStr}_${timeStr}`;
                const booking = bookingsMap[bookingId];
                
                if (isToday) {
                    if (h < currentHour || (h === currentHour && min <= currentMin)) continue;
                }

                hasSlots = true;
                const btn = document.createElement('div');
                // Grade Compacta mas com altura suficiente para os marcadores (min-h-[60px])
                btn.className = "slot-btn relative min-h-[60px] rounded border flex flex-col items-center justify-center gap-1 select-none overflow-hidden p-1";
                
                if (booking) {
                    const isMine = booking.userId === currentUser?.uid;
                    if (isMine) {
                        // Meu agendamento
                        btn.classList.add('bg-blue-900/40', 'border-blue-500', 'cursor-pointer');
                        btn.innerHTML = `
                            <span class="text-white font-bold text-sm leading-none">${timeStr}</span>
                            <span class="text-[9px] bg-red-600/80 text-white px-2 py-0.5 rounded-full hover:bg-red-500 shadow-sm font-bold uppercase tracking-wide transition-colors">Cancelar</span>
                        `;
                        btn.onclick = () => confirmCancel(bookingId, displayDate, timeStr);
                    } else {
                        // Ocupado
                        btn.classList.add('bg-neutral-800', 'border-neutral-800', 'opacity-50', 'cursor-not-allowed');
                        btn.innerHTML = `
                            <span class="text-gray-500 font-bold text-sm decoration-line-through leading-none">${timeStr}</span>
                            <span class="text-[8px] text-red-500 font-bold uppercase">Ocupado</span>
                        `;
                        btn.onclick = () => showAlert('Indisponível', 'Este horário já foi reservado.', 'lock');
                    }
                } else {
                    // Livre
                    btn.classList.add('bg-neutral-800', 'border-neutral-700', 'hover:border-yellow-500', 'hover:bg-neutral-750', 'cursor-pointer', 'group');
                    
                    if (adminConfig.isClosed) {
                        btn.classList.add('opacity-50');
                        btn.innerHTML = `<span class="text-gray-500 font-bold text-sm">${timeStr}</span>`;
                        btn.onclick = () => showAlert('Agenda Fechada', adminConfig.closedMessage || "Não estamos atendendo no momento.", 'lock');
                    } else {
                        // Livre com marcador
                        btn.innerHTML = `
                            <span class="text-white font-bold text-sm group-hover:text-yellow-500 transition-colors leading-none">${timeStr}</span>
                            <span class="text-[9px] bg-green-900/30 text-green-400 px-1.5 rounded uppercase font-bold tracking-wider">Livre</span>
                        `;
                        btn.onclick = () => openBookingModal(dateStr, timeStr, displayDate);
                    }
                }
                container.appendChild(btn);
            }
            emptyMsg.classList.toggle('hidden', hasSlots);
        }

        window.saveAdminConfig = async () => {
            if(!isAdmin) return;
            const open = parseInt(document.getElementById('conf-open').value);
            const close = parseInt(document.getElementById('conf-close').value);
            const interval = parseInt(document.getElementById('conf-interval').value);
            const isClosed = document.getElementById('conf-is-closed').checked;
            const msg = document.getElementById('conf-closed-msg').value;

            if(open >= close) return showAlert('Erro', 'O horário de abertura deve ser antes do fechamento.', 'error');

            showLoading(true);
            try {
                const newConfig = { openHour: open, closeHour: close, interval: interval, isClosed: isClosed, closedMessage: msg };
                const adminDocRef = doc(db, CONFIG_COLLECTION_PATH, ADMIN_DOC_ID);
                
                await setDoc(adminDocRef, { config: newConfig }, { merge: true });
                adminConfig = newConfig; 
                showAlert('Sucesso', 'Configurações salvas!', 'check');
                resetCalendar(); 
            } catch(e) {
                console.error(e);
                showAlert('Erro', 'Falha ao salvar configurações.', 'error');
            }
            showLoading(false);
        };

        window.openBookingModal = (dateStr, timeStr, friendlyDate) => {
            selectedTime = timeStr;
            document.getElementById('modal-date').innerText = friendlyDate;
            document.getElementById('modal-time').innerText = timeStr;
            
            // --- RESET DOS CAMPOS ---
            document.getElementById('service-select').selectedIndex = 0;
            document.getElementById('notes-input').value = '';
            
            document.getElementById('booking-modal').classList.remove('hidden');
        };

        window.confirmBooking = async () => {
            const btn = document.getElementById('btn-confirm-booking');
            const service = document.getElementById('service-select').value;
            const notes = document.getElementById('notes-input').value || ''; 
            const dateStr = getLocalISODate(selectedDate);
            const bookingId = `${dateStr}_${selectedTime}`;

            btn.disabled = true; btn.innerText = "AGENDANDO...";
            try {
                if(adminConfig.isClosed) throw new Error("SHOP_CLOSED");
                try { await checkBlockedStatus(currentUser.email); } catch (e) { if(e.message === "BLOCKED") throw e; }

                const docRef = doc(db, BOOKINGS_PATH, bookingId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    showAlert('Ops!', 'Alguém acabou de reservar este horário.', 'clock');
                } else {
                    let phoneToSave = currentUserData.phone || "Não informado";
                    if(phoneToSave === "Não informado") {
                        try {
                            const pSnap = await getDoc(doc(db, USERS_COLLECTION_PATH, currentUser.uid));
                            if(pSnap.exists()) phoneToSave = pSnap.data().phone || "Não informado";
                        } catch(e) {}
                    }
                    await setDoc(docRef, {
                        id: bookingId,
                        date: dateStr,
                        time: selectedTime,
                        service: service,
                        notes: notes,
                        userId: currentUser.uid,
                        userEmail: currentUser.email,
                        userName: currentUserData.name || currentUser.displayName || "Cliente",
                        userPhone: phoneToSave, 
                        createdAt: new Date().toISOString()
                    });
                    closeModal('booking-modal');
                    showAlert('Agendado!', `Horário (${selectedTime}) garantido.`, 'check');
                }
            } catch (error) {
                if(error.message === "BLOCKED") showAlert('Bloqueado', 'Você não pode agendar.', 'lock');
                else if(error.message === "SHOP_CLOSED") showAlert('Fechado', adminConfig.closedMessage, 'lock');
                else showAlert('Erro', 'Tente novamente.', 'error');
            } finally {
                btn.disabled = false; btn.innerText = "CONFIRMAR";
            }
        };

        window.confirmCancel = (bookingId, dateDisplay, time) => {
            showCustomConfirm('Cancelar?', `Liberar o horário das ${time}?`, async () => {
                showLoading(true);
                try { await deleteDoc(doc(db, BOOKINGS_PATH, bookingId)); showAlert('Cancelado', 'Horário liberado.', 'check'); } 
                catch (e) { showAlert('Erro', 'Não foi possível cancelar.', 'error'); }
                showLoading(false);
            });
        };

        function renderAdminList() {
            const list = document.getElementById('admin-list');
            list.innerHTML = '';
            const sortedBookings = Object.values(bookingsMap).sort((a, b) => (a.date + a.time).localeCompare(b.date + b.time));
            document.getElementById('admin-count').innerText = sortedBookings.length;
            if (sortedBookings.length === 0) { list.innerHTML = '<div class="text-gray-500 text-sm text-center py-4">Nenhum agendamento futuro.</div>'; return; }

            sortedBookings.forEach(b => {
                const [yyyy, mm, dd] = b.date.split('-');
                const formattedDate = `${dd}/${mm}`;
                const displayPhone = b.userPhone || 'Sem tel';
                const div = document.createElement('div');
                div.className = "bg-neutral-800 p-3 rounded border-l-4 border-yellow-600 flex justify-between items-start shadow-md";
                div.innerHTML = `
                    <div class="flex-1 pr-2 overflow-hidden">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="bg-yellow-600 text-black text-xs font-bold px-1.5 rounded">${b.time}</span>
                            <span class="text-gray-300 text-xs font-bold">${formattedDate}</span>
                        </div>
                        <div class="text-white font-bold text-sm truncate">${b.userName}</div>
                        <div onclick="copyToClipboard('${b.userPhone || ''}', this)" class="text-xs text-green-400 font-mono my-1 hover:text-green-300 flex items-center gap-1 w-fit cursor-pointer select-none">
                            <i class="fab fa-whatsapp"></i> ${displayPhone}
                        </div>
                        <div class="text-xs text-yellow-500/80 uppercase font-bold tracking-wide truncate">${b.service}</div>
                        ${b.notes ? `<div class="text-xs text-gray-400 italic mt-1 bg-black/20 p-1 rounded break-words">Obs: "${b.notes}"</div>` : ''}
                        <div onclick="copyToClipboard('${b.userEmail}', this)" class="text-[10px] text-gray-500 mt-2 border-t border-gray-700 pt-1 truncate cursor-pointer hover:text-yellow-500 flex items-center gap-1 select-none">
                           <i class="far fa-copy text-[8px]"></i> ${b.userEmail || 'Email não disponível'}
                        </div>
                    </div>
                    <div class="flex flex-col justify-center h-full pl-2 border-l border-gray-700">
                        <button onclick="adminDelete('${b.id}')" class="text-xs bg-red-900/50 text-red-200 p-2 rounded border border-red-900 hover:bg-red-800 transition"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        window.copyToClipboard = (text, element) => {
            if (!text || text === 'Email não disponível' || text === 'Não informado') return;
            const originalHtml = element.innerHTML;
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px";
            document.body.appendChild(textArea); textArea.focus(); textArea.select();
            try {
                if(document.execCommand('copy')) {
                     // Lógica visual específica para o botão do whatsapp
                    if (element.querySelector('.fa-whatsapp')) {
                         const span = element.querySelector('span');
                         const oldText = span.innerText;
                         span.innerText = "Copiado!";
                         setTimeout(() => { span.innerText = oldText; }, 1500);
                    } else {
                        element.classList.add('text-green-500');
                        element.innerHTML = `<i class="fas fa-check"></i> Copiado!`;
                        setTimeout(() => { element.classList.remove('text-green-500'); element.innerHTML = originalHtml; }, 1500);
                    }
                } else showAlert('Erro', 'Não foi possível copiar.', 'error');
            } catch (err) {}
            document.body.removeChild(textArea);
        };

        function renderBlockedList() {
            const list = document.getElementById('blocked-list');
            list.innerHTML = '';
            const blockedUsers = Object.values(blockedMap);
            if (blockedUsers.length === 0) { list.innerHTML = '<div class="text-gray-600 text-[10px] text-center">Nenhum bloqueio ativo.</div>'; return; }
            blockedUsers.forEach((user) => {
                const div = document.createElement('div');
                div.className = "flex justify-between items-center bg-black/30 p-2 rounded border border-white/5";
                const docId = Object.keys(blockedMap).find(key => blockedMap[key] === user);
                div.innerHTML = `
                    <span class="text-xs text-gray-300 truncate flex-1" title="${user.email}">${user.email}</span>
                    <button onclick="unblockUser('${docId}', '${user.email}')" class="text-gray-400 hover:text-green-500 ml-2"><i class="fas fa-unlock"></i></button>
                `;
                list.appendChild(div);
            });
        }

        window.unblockUser = async (docId, email) => {
            showCustomConfirm('Desbloquear?', `Liberar ${email}?`, async () => {
                showLoading(true);
                try { await deleteDoc(doc(db, BLOCKED_USERS_PATH, docId)); showAlert('Sucesso', 'Desbloqueado.', 'check'); } 
                catch (e) { showAlert('Erro', 'Falha ao desbloquear.', 'error'); }
                showLoading(false);
            });
        };

        window.adminDelete = (id) => {
            showCustomConfirm('Apagar?', 'Remover agendamento?', async () => {
                showLoading(true);
                try { await deleteDoc(doc(db, BOOKINGS_PATH, id)); } catch(e) { showAlert('Erro', 'Erro ao excluir.', 'error'); }
                showLoading(false);
            });
        };

        window.blockUserAction = async () => {
            const email = document.getElementById('block-email-input').value.trim();
            if (!email || email === currentUser.email) return showAlert('Erro', 'Email inválido ou próprio.', 'error');
            showLoading(true);
            try {
                await setDoc(doc(collection(db, BLOCKED_USERS_PATH)), { email, blockedBy: currentUser.email, blockedAt: new Date().toISOString() });
                document.getElementById('block-email-input').value = ''; showAlert('Bloqueado', `Acesso revogado para ${email}.`, 'check');
            } catch (e) { showAlert('Erro', 'Falha ao bloquear.', 'error'); }
            showLoading(false);
        };

        const loginForm = document.getElementById('login-form');
        const regForm = document.getElementById('register-form');
        
        // Listener de Login
        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-login-submit');
            btn.disabled = true; btn.innerText = "ENTRANDO...";
            try { await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-pass').value); } 
            catch (error) { showAlert('Acesso Negado', translateAuthError(error.code), 'error'); btn.disabled = false; btn.innerText = "ENTRAR"; }
        };

        // Listener de Cadastro
        regForm.onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-reg-submit');
            const name = document.getElementById('reg-name').value;
            const phone = document.getElementById('reg-phone').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;

            if(phone.length < 10) return showAlert('Erro', 'Telefone inválido.', 'error');
            btn.disabled = true; btn.innerText = "CADASTRANDO...";
            try {
                const userCred = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(userCred.user, { displayName: name });
                await setDoc(doc(db, USERS_COLLECTION_PATH, userCred.user.uid), { phone, email, name, createdAt: new Date().toISOString() });
                currentUserData = { phone, email, name };
            } catch (error) { showAlert('Erro', translateAuthError(error.code), 'error'); btn.disabled = false; btn.innerText = "CADASTRAR"; }
        };

        window.resetPassword = async () => {
            const email = document.getElementById('login-email').value;
            if(!email) return showAlert('Recuperação', 'Digite seu e-mail.', 'info');
            showLoading(true);
            try { await sendPasswordResetEmail(auth, email); showAlert('Email Enviado', 'Verifique sua caixa de entrada.', 'check'); } 
            catch(e) { showAlert('Erro', translateAuthError(e.code), 'error'); }
            showLoading(false);
        }

        window.logout = () => { unsubscribeBookings && unsubscribeBookings(); unsubscribeBlocked && unsubscribeBlocked(); signOut(auth); };
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        function showLoading(show) { document.getElementById('loading').classList.toggle('hidden', !show); }
        window.showScreen = (screenId) => {
            ['auth-screen', 'dashboard-screen', 'admin-screen'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            if (screenId === 'admin-screen') { renderAdminList(); renderBlockedList(); }
        };
        window.showAlert = (title, msg, type) => {
            const alertEl = document.getElementById('custom-alert');
            document.getElementById('alert-icon').innerHTML = type === 'error' ? '<i class="fas fa-times-circle text-red-600"></i>' : type === 'check' ? '<i class="fas fa-check-circle text-green-500"></i>' : type === 'lock' ? '<i class="fas fa-lock text-yellow-500"></i>' : '<i class="fas fa-info-circle text-blue-400"></i>';
            document.getElementById('alert-title').innerText = title; document.getElementById('alert-msg').innerText = msg;
            document.getElementById('alert-actions').innerHTML = `<button onclick="closeAlert()" class="bg-neutral-700 text-white px-4 py-2 rounded hover:bg-neutral-600 w-full font-semibold">OK</button>`;
            alertEl.classList.remove('hidden');
        };
        window.showCustomConfirm = (title, msg, onConfirm) => {
             const alertEl = document.getElementById('custom-alert');
             document.getElementById('alert-icon').innerHTML = '<i class="fas fa-question-circle text-yellow-500 animate-bounce"></i>';
             document.getElementById('alert-title').innerText = title; document.getElementById('alert-msg').innerText = msg;
             const actions = document.getElementById('alert-actions'); actions.innerHTML = '';
             const btnNo = document.createElement('button'); btnNo.className = "bg-neutral-600 text-white px-4 py-2 rounded hover:bg-neutral-500 flex-1 font-bold"; btnNo.innerText = "NÃO"; btnNo.onclick = closeAlert;
             const btnYes = document.createElement('button'); btnYes.className = "bg-red-600 text-white px-4 py-2 rounded hover:bg-red-500 flex-1 font-bold shadow-lg"; btnYes.innerText = "SIM"; btnYes.onclick = () => { closeAlert(); onConfirm(); };
             actions.appendChild(btnNo); actions.appendChild(btnYes); alertEl.classList.remove('hidden');
        };
        window.closeAlert = () => document.getElementById('custom-alert').classList.add('hidden');
        function translateAuthError(code) { const e = { 'auth/email-already-in-use': 'Email em uso.', 'auth/invalid-email': 'Email inválido.', 'auth/weak-password': 'Senha fraca.', 'auth/user-not-found': 'Conta não encontrada.', 'auth/wrong-password': 'Senha incorreta.' }; return e[code] || 'Erro desconhecido.'; }
    </script>
</body>
</html>
